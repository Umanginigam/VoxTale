{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/voice-storytelling/frontend/pages/room/%5Bid%5D.tsx"],"sourcesContent":["// import { useParams } from \"next/navigation\";\n// import { useEffect, useState, useRef } from \"react\";\n// import { recordAudio } from \"@/utils/recorder\";\n// import { uploadAudio } from \"@/utils/upload\";\n\n// export default function Room() {\n//   const params = useParams();\n//   const id = params?.id as string;\n\n//   const [messages, setMessages] = useState<any[]>([]);\n//   const [recorder, setRecorder] = useState<any>(null);\n//   const [recording, setRecording] = useState(false);\n//   const [aiThinking, setAiThinking] = useState(false)\n\n\n//   const wsRef = useRef<WebSocket | null>(null);\n//   const userId = useRef(Math.random().toString(36).slice(2, 7));\n\n//   function playAudio(url: string) {\n//     const audio = new Audio(url)\n//     audio.play()\n//   }\n\n//   useEffect(() => {\n//     if (!id) return;\n\n//     const ws = new WebSocket(\n//       `ws://localhost:8000/ws/${id}/${userId.current}`\n//     );\n\n//     ws.onmessage = (event) => {\n//       const data = JSON.parse(event.data);\n//       setMessages((prev) => [...prev, data]);\n      \n//       // Play AI audio if available\n//       if (data.event === \"AI_MESSAGE\" && data.turn?.audio_path) {\n//         playAudio(`http://localhost:8000/${data.turn.audio_path}`)\n//       }\n//     };\n\n//     ws.onopen = () => console.log(\"WS connected\");\n//     ws.onclose = () => console.log(\"WS closed\");\n\n//     wsRef.current = ws;\n\n//     return () => ws.close();\n//   }, [id]);\n\n//   async function startRecording() {\n//     const rec = await recordAudio();\n//     setRecorder(rec);\n//     setRecording(true);\n//   }\n\n//   async function stopRecording() {\n//   const audioBlob = await recorder.stop()\n//   setRecording(false)\n\n//   // 1Ô∏è‚É£ Upload audio\n//   await uploadAudio(audioBlob, id as string, userId.current)\n\n//   // 2Ô∏è‚É£ Tell backend the turn ended\n//   setAiThinking(true) // üîë START THINKING\n\n//   await fetch(\"http://localhost:8000/end-turn\", {\n//     method: \"POST\",\n//     headers: { \"Content-Type\": \"application/json\" },\n//     body: JSON.stringify({ room_id: id })\n//   })\n// }\n\n\n//   return (\n//     <div style={{ padding: 40 }}>\n//       <h2>Room: {id}</h2>\n     \n\n\n//       <div style={{ marginBottom: 20 }}>\n//         {!recording ? (\n//           <button onClick={startRecording}>Start Recording</button>\n//         ) : (\n//           <button onClick={stopRecording}>Stop Recording</button>\n//         )}\n//          {aiThinking && (\n//   <p style={{ color: \"orange\", fontStyle: \"italic\" }}>\n//     ü§ñ AI is thinking...\n//   </p>\n// )}\n//       </div>\n\n//       <div style={{ marginBottom: 20 }}>\n//         {messages.map((m, i) => {\n//           if (m.event === \"AI_MESSAGE\") {\n//             return (\n//               <div key={i}>\n//                 <p>\n//                   <b style={{ color: \"purple\" }}>AI:</b>{\" \"}\n//                   {m.turn.transcript}\n//                 </p>\n//                 {m.turn?.speaker === \"AI\" && <p>üîä AI Narrating...</p>}\n//               </div>\n//             );\n//           }\n          \n\n//           if (m.event === \"USER_JOINED\") {\n//             return (\n//               <p key={i} style={{ color: \"gray\" }}>\n//                 User {m.user} joined\n//               </p>\n//             );\n//           }\n\n//           return null;\n//         })}\n//       </div>\n\n//       <pre>{JSON.stringify(messages, null, 2)}</pre>\n//     </div>\n//   );\n// }\n"],"names":[],"mappings":"AAAA,+CAA+C;AAC/C,uDAAuD;AACvD,kDAAkD;AAClD,gDAAgD;AAEhD,mCAAmC;AACnC,gCAAgC;AAChC,qCAAqC;AAErC,yDAAyD;AACzD,yDAAyD;AACzD,uDAAuD;AACvD,wDAAwD;AAGxD,kDAAkD;AAClD,mEAAmE;AAEnE,sCAAsC;AACtC,mCAAmC;AACnC,mBAAmB;AACnB,MAAM;AAEN,sBAAsB;AACtB,uBAAuB;AAEvB,gCAAgC;AAChC,yDAAyD;AACzD,SAAS;AAET,kCAAkC;AAClC,6CAA6C;AAC7C,gDAAgD;AAEhD,sCAAsC;AACtC,oEAAoE;AACpE,qEAAqE;AACrE,UAAU;AACV,SAAS;AAET,qDAAqD;AACrD,mDAAmD;AAEnD,0BAA0B;AAE1B,+BAA+B;AAC/B,cAAc;AAEd,sCAAsC;AACtC,uCAAuC;AACvC,wBAAwB;AACxB,0BAA0B;AAC1B,MAAM;AAEN,qCAAqC;AACrC,4CAA4C;AAC5C,wBAAwB;AAExB,wBAAwB;AACxB,+DAA+D;AAE/D,uCAAuC;AACvC,6CAA6C;AAE7C,oDAAoD;AACpD,sBAAsB;AACtB,uDAAuD;AACvD,4CAA4C;AAC5C,OAAO;AACP,IAAI;AAGJ,aAAa;AACb,oCAAoC;AACpC,4BAA4B;AAI5B,2CAA2C;AAC3C,0BAA0B;AAC1B,sEAAsE;AACtE,gBAAgB;AAChB,oEAAoE;AACpE,aAAa;AACb,4BAA4B;AAC5B,yDAAyD;AACzD,2BAA2B;AAC3B,SAAS;AACT,KAAK;AACL,eAAe;AAEf,2CAA2C;AAC3C,oCAAoC;AACpC,4CAA4C;AAC5C,uBAAuB;AACvB,8BAA8B;AAC9B,sBAAsB;AACtB,gEAAgE;AAChE,wCAAwC;AACxC,uBAAuB;AACvB,0EAA0E;AAC1E,uBAAuB;AACvB,iBAAiB;AACjB,cAAc;AAGd,6CAA6C;AAC7C,uBAAuB;AACvB,sDAAsD;AACtD,uCAAuC;AACvC,qBAAqB;AACrB,iBAAiB;AACjB,cAAc;AAEd,yBAAyB;AACzB,cAAc;AACd,eAAe;AAEf,uDAAuD;AACvD,aAAa;AACb,OAAO;AACP,IAAI"}}]
}