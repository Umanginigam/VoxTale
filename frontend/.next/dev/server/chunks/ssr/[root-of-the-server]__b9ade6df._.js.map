{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/voice-storytelling/frontend/utils/recorder.ts"],"sourcesContent":["export async function recordAudio() {\n  const stream = await navigator.mediaDevices.getUserMedia({ audio: true })\n  const mediaRecorder = new MediaRecorder(stream)\n  const chunks: BlobPart[] = []\n\n  mediaRecorder.ondataavailable = e => chunks.push(e.data)\n  mediaRecorder.start()\n\n  return {\n    stop: () =>\n      new Promise<Blob>((resolve) => {\n        mediaRecorder.onstop = () => {\n          const blob = new Blob(chunks, { type: \"audio/webm\" })\n          resolve(blob)\n        }\n        mediaRecorder.stop()\n      })\n  }\n}\n"],"names":[],"mappings":";;;;AAAO,eAAe;IACpB,MAAM,SAAS,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;QAAE,OAAO;IAAK;IACvE,MAAM,gBAAgB,IAAI,cAAc;IACxC,MAAM,SAAqB,EAAE;IAE7B,cAAc,eAAe,GAAG,CAAA,IAAK,OAAO,IAAI,CAAC,EAAE,IAAI;IACvD,cAAc,KAAK;IAEnB,OAAO;QACL,MAAM,IACJ,IAAI,QAAc,CAAC;gBACjB,cAAc,MAAM,GAAG;oBACrB,MAAM,OAAO,IAAI,KAAK,QAAQ;wBAAE,MAAM;oBAAa;oBACnD,QAAQ;gBACV;gBACA,cAAc,IAAI;YACpB;IACJ;AACF"}},
    {"offset": {"line": 56, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/voice-storytelling/frontend/utils/upload.ts"],"sourcesContent":["export async function uploadAudio(\n  blob: Blob,\n  roomId: string,\n  userId: string\n) {\n  const formData = new FormData()\n  formData.append(\"file\", blob)\n\n  const res = await fetch(\n    `http://localhost:8000/upload-audio?room_id=${roomId}&user_id=${userId}`,\n    { method: \"POST\", body: formData }\n  )\n\n  return res.json()\n}\n"],"names":[],"mappings":";;;;AAAO,eAAe,YACpB,IAAU,EACV,MAAc,EACd,MAAc;IAEd,MAAM,WAAW,IAAI;IACrB,SAAS,MAAM,CAAC,QAAQ;IAExB,MAAM,MAAM,MAAM,MAChB,CAAC,2CAA2C,EAAE,OAAO,SAAS,EAAE,QAAQ,EACxE;QAAE,QAAQ;QAAQ,MAAM;IAAS;IAGnC,OAAO,IAAI,IAAI;AACjB"}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/voice-storytelling/frontend/pages/room/%5Bid%5D.tsx"],"sourcesContent":["import { useParams } from \"next/navigation\";\nimport { useEffect, useState, useRef } from \"react\";\nimport { recordAudio } from \"@/utils/recorder\";\nimport { uploadAudio } from \"@/utils/upload\";\n\nexport default function Room() {\n  const params = useParams();\n  const id = params?.id as string;\n\n  const [messages, setMessages] = useState<any[]>([]);\n  const [recorder, setRecorder] = useState<any>(null);\n  const [recording, setRecording] = useState(false);\n  const [aiThinking, setAiThinking] = useState(false)\n\n\n  const wsRef = useRef<WebSocket | null>(null);\n  const userId = useRef(Math.random().toString(36).slice(2, 7));\n\n  function playAudio(url: string) {\n    const audio = new Audio(url)\n    audio.play()\n  }\n\n  useEffect(() => {\n    if (!id) return;\n\n    const ws = new WebSocket(\n      `ws://localhost:8000/ws/${id}/${userId.current}`\n    );\n\n    ws.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      setMessages((prev) => [...prev, data]);\n      \n      // Play AI audio if available\n      if (data.event === \"AI_MESSAGE\" && data.turn?.audio_path) {\n        playAudio(`http://localhost:8000/${data.turn.audio_path}`)\n      }\n    };\n\n    ws.onopen = () => console.log(\"WS connected\");\n    ws.onclose = () => console.log(\"WS closed\");\n\n    wsRef.current = ws;\n\n    return () => ws.close();\n  }, [id]);\n\n  async function startRecording() {\n    const rec = await recordAudio();\n    setRecorder(rec);\n    setRecording(true);\n  }\n\n  async function stopRecording() {\n  const audioBlob = await recorder.stop()\n  setRecording(false)\n\n  // 1Ô∏è‚É£ Upload audio\n  await uploadAudio(audioBlob, id as string, userId.current)\n\n  // 2Ô∏è‚É£ Tell backend the turn ended\n  setAiThinking(true) // üîë START THINKING\n\n  await fetch(\"http://localhost:8000/end-turn\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ room_id: id })\n  })\n}\n\n\n  return (\n    <div style={{ padding: 40 }}>\n      <h2>Room: {id}</h2>\n     \n\n\n      <div style={{ marginBottom: 20 }}>\n        {!recording ? (\n          <button onClick={startRecording}>Start Recording</button>\n        ) : (\n          <button onClick={stopRecording}>Stop Recording</button>\n        )}\n         {aiThinking && (\n  <p style={{ color: \"orange\", fontStyle: \"italic\" }}>\n    ü§ñ AI is thinking...\n  </p>\n)}\n      </div>\n\n      <div style={{ marginBottom: 20 }}>\n        {messages.map((m, i) => {\n          if (m.event === \"AI_MESSAGE\") {\n            return (\n              <div key={i}>\n                <p>\n                  <b style={{ color: \"purple\" }}>AI:</b>{\" \"}\n                  {m.turn.transcript}\n                </p>\n                {m.turn?.speaker === \"AI\" && <p>üîä AI Narrating...</p>}\n              </div>\n            );\n          }\n          \n\n          if (m.event === \"USER_JOINED\") {\n            return (\n              <p key={i} style={{ color: \"gray\" }}>\n                User {m.user} joined\n              </p>\n            );\n          }\n\n          return null;\n        })}\n      </div>\n\n      <pre>{JSON.stringify(messages, null, 2)}</pre>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;AAEe,SAAS;IACtB,MAAM,SAAS,IAAA,wIAAS;IACxB,MAAM,KAAK,QAAQ;IAEnB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAQ,EAAE;IAClD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAM;IAC9C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,+GAAQ,EAAC;IAC3C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,+GAAQ,EAAC;IAG7C,MAAM,QAAQ,IAAA,6GAAM,EAAmB;IACvC,MAAM,SAAS,IAAA,6GAAM,EAAC,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG;IAE1D,SAAS,UAAU,GAAW;QAC5B,MAAM,QAAQ,IAAI,MAAM;QACxB,MAAM,IAAI;IACZ;IAEA,IAAA,gHAAS,EAAC;QACR,IAAI,CAAC,IAAI;QAET,MAAM,KAAK,IAAI,UACb,CAAC,uBAAuB,EAAE,GAAG,CAAC,EAAE,OAAO,OAAO,EAAE;QAGlD,GAAG,SAAS,GAAG,CAAC;YACd,MAAM,OAAO,KAAK,KAAK,CAAC,MAAM,IAAI;YAClC,YAAY,CAAC,OAAS;uBAAI;oBAAM;iBAAK;YAErC,6BAA6B;YAC7B,IAAI,KAAK,KAAK,KAAK,gBAAgB,KAAK,IAAI,EAAE,YAAY;gBACxD,UAAU,CAAC,sBAAsB,EAAE,KAAK,IAAI,CAAC,UAAU,EAAE;YAC3D;QACF;QAEA,GAAG,MAAM,GAAG,IAAM,QAAQ,GAAG,CAAC;QAC9B,GAAG,OAAO,GAAG,IAAM,QAAQ,GAAG,CAAC;QAE/B,MAAM,OAAO,GAAG;QAEhB,OAAO,IAAM,GAAG,KAAK;IACvB,GAAG;QAAC;KAAG;IAEP,eAAe;QACb,MAAM,MAAM,MAAM,IAAA,yHAAW;QAC7B,YAAY;QACZ,aAAa;IACf;IAEA,eAAe;QACf,MAAM,YAAY,MAAM,SAAS,IAAI;QACrC,aAAa;QAEb,mBAAmB;QACnB,MAAM,IAAA,uHAAW,EAAC,WAAW,IAAc,OAAO,OAAO;QAEzD,kCAAkC;QAClC,cAAc,OAAM,oBAAoB;QAExC,MAAM,MAAM,kCAAkC;YAC5C,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE,SAAS;YAAG;QACrC;IACF;IAGE,qBACE,qKAAC;QAAI,OAAO;YAAE,SAAS;QAAG;;0BACxB,qKAAC;;oBAAG;oBAAO;;;;;;;0BAIX,qKAAC;gBAAI,OAAO;oBAAE,cAAc;gBAAG;;oBAC5B,CAAC,0BACA,qKAAC;wBAAO,SAAS;kCAAgB;;;;;6CAEjC,qKAAC;wBAAO,SAAS;kCAAe;;;;;;oBAEhC,4BACR,qKAAC;wBAAE,OAAO;4BAAE,OAAO;4BAAU,WAAW;wBAAS;kCAAG;;;;;;;;;;;;0BAMhD,qKAAC;gBAAI,OAAO;oBAAE,cAAc;gBAAG;0BAC5B,SAAS,GAAG,CAAC,CAAC,GAAG;oBAChB,IAAI,EAAE,KAAK,KAAK,cAAc;wBAC5B,qBACE,qKAAC;;8CACC,qKAAC;;sDACC,qKAAC;4CAAE,OAAO;gDAAE,OAAO;4CAAS;sDAAG;;;;;;wCAAQ;wCACtC,EAAE,IAAI,CAAC,UAAU;;;;;;;gCAEnB,EAAE,IAAI,EAAE,YAAY,sBAAQ,qKAAC;8CAAE;;;;;;;2BALxB;;;;;oBAQd;oBAGA,IAAI,EAAE,KAAK,KAAK,eAAe;wBAC7B,qBACE,qKAAC;4BAAU,OAAO;gCAAE,OAAO;4BAAO;;gCAAG;gCAC7B,EAAE,IAAI;gCAAC;;2BADP;;;;;oBAIZ;oBAEA,OAAO;gBACT;;;;;;0BAGF,qKAAC;0BAAK,KAAK,SAAS,CAAC,UAAU,MAAM;;;;;;;;;;;;AAG3C"}}]
}